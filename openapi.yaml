openapi: 3.0.0
info:
  title: WebServices Meow API
  version: 1.0.0
  description: API de gestion de stationnements avec authentification par clé API
  contact:
    name: WebServices Meow
    email: contact@webservicesmeow.com

servers:
  - url: http://localhost:3000
    description: Serveur de développement

tags:
  - name: General
    description: Informations générales sur le service
  - name: Parking
    description: Opérations de gestion des stationnements
  - name: WebSocket
    description: Fonctionnalités temps réel (notifications, timers)

paths:
  /:
    get:
      summary: Page d'accueil du service
      description: Informations générales sur le service de stationnement
      tags: [General]
      responses:
        '200':
          description: Informations sur le service
          content:
            application/json:
              schema:
                type: object
                properties:
                  service:
                    type: string
                    example: "WebServices Meow - Parking Service"
                  version:
                    type: string
                    example: "1.0.0"
                  description:
                    type: string
                    example: "Service de gestion des stationnements pour équipes tierces"
                  documentation:
                    type: string
                    example: "http://localhost:3000/api-docs"
                  endpoints:
                    type: object
                    properties:
                      parking:
                        type: string
                        example: "/api/v1/parking"
                      websocket:
                        type: string
                        example: "ws://localhost:3000/socket.io/"

  /api/v1/parking/{user_id}:
    post:
      summary: Enregistrer une nouvelle position de parking
      description: |
        Enregistre une nouvelle position de stationnement pour un utilisateur donné.
      tags: [Parking]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParkingRequest'
            example:
              latitude: 48.8566
              longitude: 2.3522
              address: "Place de la Concorde, Paris"
              note: "Parking créé par l'équipe front"
      responses:
        '201':
          description: Parking créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Données invalides
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Erreur de validation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/parking/{user_id}/current:
    get:
      summary: Récupérer la dernière position
      description: Récupère la dernière position de stationnement enregistrée pour un utilisateur
      tags: [Parking]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur
          example: 1
      responses:
        '200':
          description: Dernière position récupérée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  parking:
                    $ref: '#/components/schemas/Parking'
        '404':
          description: Aucune position trouvée pour cet utilisateur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/parking/{user_id}/history:
    get:
      summary: Récupérer l'historique des positions
      description: Retourne l'historique paginé des positions de parking pour un utilisateur
      tags: [Parking]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur
          example: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Nombre maximum de résultats à retourner
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Nombre de résultats à ignorer (pour la pagination)
      responses:
        '200':
          description: Historique récupéré avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  parkings:
                    type: array
                    items:
                      $ref: '#/components/schemas/Parking'
                  pagination:
                    $ref: '#/components/schemas/PaginationInfo'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/parking/{user_id}/{parkingId}:
    get:
      summary: Obtenir un parking spécifique
      description: Récupère les détails d'un parking par son ID pour un utilisateur donné
      tags: [Parking]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur
          example: 1
        - in: path
          name: parkingId
          required: true
          schema:
            type: integer
          description: ID du parking
          example: 123
      responses:
        '200':
          description: Parking récupéré avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  parking:
                    $ref: '#/components/schemas/Parking'
        '404':
          description: Parking introuvable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      summary: Mettre à jour une position de parking
      description: Met à jour les informations d'un parking existant (adresse, note)
      tags: [Parking]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur propriétaire du parking
          example: 1
        - in: path
          name: parkingId
          required: true
          schema:
            type: integer
          description: ID du parking à modifier
          example: 123
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParkingUpdateRequest'
            example:
              address: "123 Rue de la Paix, 75001 Paris"
              note: "Stationnement mis à jour avec nouvelle info"
      responses:
        '200':
          description: Parking mis à jour avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Données invalides
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Parking introuvable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Supprimer une position de parking
      description: Supprime définitivement un parking du système pour un utilisateur donné
      tags: [Parking]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur propriétaire du parking
          example: 1
        - in: path
          name: parkingId
          required: true
          schema:
            type: integer
          description: ID du parking à supprimer
          example: 123
      responses:
        '200':
          description: Parking supprimé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Position supprimée avec succès"
        '404':
          description: Parking introuvable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/parking/{user_id}/{parkingId}/start-timer:
    post:
      summary: Démarrer un chronomètre de parking
      description: |
        Démarre un chronomètre pour un parking donné appartenant à un utilisateur. 
        Utilisé avec WebSocket pour recevoir des notifications en temps réel.
      tags: [WebSocket]
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: ID de l'utilisateur propriétaire du parking
          example: 1
        - in: path
          name: parkingId
          required: true
          schema:
            type: integer
          description: ID du parking
          example: 123
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                duration:
                  type: integer
                  minimum: 1
                  maximum: 86400
                  default: 10
                  description: Durée du chronomètre en secondes
                  example: 10
            example:
              duration: 10
      responses:
        '200':
          description: Chronomètre démarré avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Chronomètre démarré"
                  timer:
                    type: object
                    properties:
                      parkingId:
                        type: integer
                        example: 123
                      duration:
                        type: integer
                        example: 10
                      startTime:
                        type: string
                        format: date-time
                        example: "2025-11-21T10:30:00Z"
                      endTime:
                        type: string
                        format: date-time
                        example: "2025-11-21T10:30:10Z"
        '404':
          description: Parking introuvable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Clé API manquante ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur serveur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: Clé API pour l'authentification

  schemas:
    Parking:
      type: object
      properties:
        id:
          type: integer
          description: ID unique du stationnement
        user_id:
          type: integer
          description: ID utilisateur envoyé par le client
        latitude:
          type: number
          format: float
          description: Latitude GPS
        longitude:
          type: number
          format: float
          description: Longitude GPS
        address:
          type: string
          description: Adresse du stationnement
          nullable: true
        note:
          type: string
          description: Note ou commentaire
          nullable: true
        created_at:
          type: string
          format: date-time
          description: Date de création

    ParkingRequest:
      type: object
      required: [latitude, longitude]
      properties:
        latitude:
          type: number
          format: float
          minimum: -90
          maximum: 90
          description: Latitude GPS (-90 à 90)
        longitude:
          type: number
          format: float
          minimum: -180
          maximum: 180
          description: Longitude GPS (-180 à 180)
        address:
          type: string
          description: Adresse du stationnement
        note:
          type: string
          description: Note ou commentaire

    ParkingUpdateRequest:
      type: object
      properties:
        address:
          type: string
          description: Nouvelle adresse du stationnement
          example: "123 Rue de la Paix, Paris"
        note:
          type: string
          description: Nouvelle note ou commentaire
          example: "Stationnement mis à jour"

    PaginationInfo:
      type: object
      properties:
        total:
          type: integer
          description: Nombre total d'éléments disponibles
          example: 150
        limit:
          type: integer
          description: Nombre d'éléments par page
          example: 50
        offset:
          type: integer
          description: Nombre d'éléments ignorés (décalage)
          example: 0
        hasMore:
          type: boolean
          description: Indique s'il y a plus d'éléments à récupérer
          example: true

    Error:
      type: object
      properties:
        error:
          type: string
          description: Type d'erreur
          example: "Validation failed"
        message:
          type: string
          description: Message d'erreur détaillé
          example: "Le champ latitude est requis"
        details:
          type: array
          items:
            type: string
          description: Détails supplémentaires de l'erreur
          example: ["latitude: required field", "longitude: must be between -180 and 180"]

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          description: Message de succès
          example: "Position enregistrée avec succès"
        parking:
          $ref: '#/components/schemas/Parking'
